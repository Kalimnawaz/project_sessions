# container cpu usage
rate(container_cpu_usage_seconds_total{pod=~"myapp-production-.*", image!="", container!="POD"}[5m])

# container memory usage
container_memory_working_set_bytes{pod=~"myapp-production-.*", image!="", container!="POD"}

# alert
sum(rate(container_cpu_usage_seconds_total{namespace="default", pod=~"myapp-production-.*"}[5m])) by (pod)

sum by (cpu) (rate(node_cpu_seconds_total{mode!="idle"}[1m]))

    groups:
    - name: alert.cpu
      rules:
      - alert: PodCPUUsageTooHigh
        annotations:
          summary: "Pod CPU usage is too high"
          description: "CPU usage for pod {{ $labels.pod }} in namespace {{ $labels.namespace }} exceeds 30% of its limits."
        expr: (sum(rate(container_cpu_usage_seconds_total{namespace="default", pod=~"myapp-production-.*"}[1m])) / sum(kube_pod_container_resource_limits{namespace="default", pod=~"myapp-production-.*"})) * 100 > 10
        for: 1m
        labels:
          severity: critical
