sudo yum update -y
sudo yum install -y docker
sudo service docker start
sudo usermod -aG docker ec2-user

sudo tee /etc/yum.repos.d/kubernetes.repo <<EOF
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF

sudo yum install -y kubelet-1.22.0 kubeadm-1.22.0 kubectl-1.22.0 --disableexcludes=kubernetes
sudo systemctl enable --now kubelet

sudo kubeadm init --kubernetes-version=1.22.0 --pod-network-cidr=192.168.0.0/16

kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

##coredn issue : https://github.com/kubernetes/kubernetes/issues/70202
sudo tee /run/flannel/subnet.env <<EOF

FLANNEL_NETWORK=10.244.0.0/16
FLANNEL_SUBNET=10.244.0.1/24
FLANNEL_MTU=1450
FLANNEL_IPMASQ=true

EOF
## Debugging
https://www.goglides.dev/bkpandey/journalctl-to-debug-kubernetes-3h0j#:~:text=The%20command%20journalctl%20%2Dx%20%2Df,displayed%20as%20they%20are%20generated.

https://www.loggly.com/ultimate-guide/using-journalctl/

##
sudo kubeadm init --pod-network-cidr=10.17.0.0/16 --service-cidr=10.18.0.0/24 --kubernetes-version=1.22.0

##
kubectl taint node mymasternode node-role.kubernetes.io/master:NoSchedule-
